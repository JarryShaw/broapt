<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BroAPT-Core Extration Framework &#8212; BroAPT 2020.03.14 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=039e1c02" />
    <script src="_static/documentation_options.js?v=628af7cf"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="BroAPT-App Detection Framework" href="broapt-app.html" />
    <link rel="prev" title="Internal Frameworks" href="framework.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="broapt-core-extration-framework">
<h1>BroAPT-Core Extration Framework<a class="headerlink" href="#broapt-core-extration-framework" title="Link to this heading">¶</a></h1>
<p>The BroAPT-Core framework processes PCAP files, extracts files transferred
through traffic contained in the PCAP files, and perform analysis to the log
files generated by Bro scripts.</p>
<img alt="BroAPT-Core Extration Framework" src="_images/BroAPT.006.png" />
<ol class="arabic" start="0">
<li><p>When the BroAPT-Core framework first reads in a new PCAP file, it will
validate if it’s a valid <a class="reference external" href="https://www.tcpdump.org"><code class="docutils literal notranslate"><span class="pre">tcpdump</span></code></a> (<em class="manpage"><a class="manpage reference external" href="https://linux.die.net/man/1/tcpdump">tcpdump(1)</a></em>) format file,
through <a class="reference external" href="https://pypi.org/project/python-libmagic"><code class="docutils literal notranslate"><span class="pre">libmagic</span></code></a> (<em class="manpage"><a class="manpage reference external" href="https://linux.die.net/man/3/libmagic">libmagic(3)</a></em>).</p></li>
<li><p>If validated, the BroAPT-Core framework will utilise the Bro IDS to
perform analysis upon the PCAP file, extracting files and generating logs.</p>
<p>When extracting, you may toggle through <a class="reference internal" href="configuration.html"><span class="doc">environment variables</span></a>
to configure which MIME types and/or what application layer protocol files
transferred with should be extracted.</p>
<p>Also, site functions from user-defined Bro scripts will be loaded and executed
at the same time.</p>
<p>This step will produce extracted files and standard Bro logs, as well as
extra artefacts elevated through the site functions.</p>
</li>
<li><p>Later, the BroAPT-Core framework will perform post-processing, a.k.a.
cross-analysis, upon the logs generated in previous step.</p>
<p>By default, the BroAPT-Core framework will gather connection information
of the extracted files from the Bro logs (<code class="docutils literal notranslate"><span class="pre">files.log</span></code>). Some other analysis
will also be performed as defined in the Python hooks.</p>
<p>The result of analysis will be elevated as BroAPT logs.</p>
</li>
</ol>
<section id="custom-bro-scripts">
<h2>Custom Bro Scripts<a class="headerlink" href="#custom-bro-scripts" title="Link to this heading">¶</a></h2>
<p>In the BroAPT system, you can customise your own Bro script. The BroAPT-Core
framework will load those scripts when running Bro IDS to process PCAP files.</p>
<p>User defined Bro scripts will be mapped into the Docker container at runtime.
The directory structure would be as following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/broapt/scripts/
│   # load FileExtraction module
├── __load__.bro
│   # configurations
├── config.bro
│   # MIME-extension mappings
├── file-extensions.bro
│   # protocol hooks
├── hooks/
│   │   # extract DTLS
│   ├── extract-dtls.bro
│   │   # extract FTP_DATA
│   ├── extract-ftp.bro
│   │   # extract HTTP
│   ├── extract-http.bro
│   │   # extract IRC_DATA
│   ├── extract-irc.bro
│   │   # extract SMTP
│   └── extract-smtp.bro
│   # core logic
├── main.bro
│   # MIME hooks
│── plugins/
│   │   # extract all files
│   ├── extract-all-files.bro
│   │   # extract APK
│   ├── extract-application-vnd-android-package-archive.bro
│   │   # extract PDF
│   ├── extract-application-pdf.bro
│   │   # extract PE
│   ├── extract-application-vnd-microsoft-portable-executable.bro
│   │   # extract by BRO_MIME
│   └── extract-white-list.bro
│   # site functions by user
└── sites/
   │   # load site functions
   ├── __load__.bro
   └── ...
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">extract-application-vnd-android-package-archive.bro</span></code>,
<code class="docutils literal notranslate"><span class="pre">extract-application-pdf.bro</span></code> and
<code class="docutils literal notranslate"><span class="pre">extract-application-vnd-microsoft-portable-executable.bro</span></code> are Bro scripts
generated automatically by the BroAPT-Core framework based on the
<span class="target" id="index-0"></span><a class="reference internal" href="configuration.html#envvar-BROAPT_LOAD_MIME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">BROAPT_LOAD_MIME</span></code></a> environment vairable.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <span class="target" id="index-1"></span><a class="reference internal" href="configuration.html#envvar-BROAPT_LOAD_MIME"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">BROAPT_LOAD_MIME</span></code></a> supports UNIX <em>shell</em>-like pattern matching,
c.f. <a class="reference external" href="https://docs.python.org/3/library/fnmatch.html"><code class="docutils literal notranslate"><span class="pre">fnmatch</span></code></a> module from Python.</p>
</div>
<p>And <code class="docutils literal notranslate"><span class="pre">/broapt/scripts/sites/</span></code> are mapped from the host machine, which includes
the Bro scripts defined by user. You may include your scripts into the
BroAPT-Core framework by loading (<code class="docutils literal notranslate"><span class="pre">&#64;load</span></code>) them in the
<code class="docutils literal notranslate"><span class="pre">/broapt/scripts/sites/__load__.bro</span></code> file.</p>
<p>At the moment, we have six sets of Bro scripts included in the distribution.</p>
<section id="common-constants">
<h3>Common Constants<a class="headerlink" href="#common-constants" title="Link to this heading">¶</a></h3>
<p>In the BroAPT system, it predefines many constants of common protocols and
systems, such as FTP commands, HTTP methods, etc. We used crawlers to fetch
relevant data from the IANA registry, generate and/or update Bro constants,
such as <code class="docutils literal notranslate"><span class="pre">HTTP::header_names</span></code> for HTTP headers fields.</p>
</section>
<section id="http-cookies">
<h3>HTTP Cookies<a class="headerlink" href="#http-cookies" title="Link to this heading">¶</a></h3>
<p>The script utilised <a class="reference external" href="https://docs.zeek.org/en/current/scripts/base/bif/plugins/Zeek_HTTP.events.bif.zeek.html#id-http_header"><code class="docutils literal notranslate"><span class="pre">http_header</span></code></a> event, and extends the builtin <code class="docutils literal notranslate"><span class="pre">http.log</span></code>
record object <a class="reference external" href="https://docs.zeek.org/en/current/scripts/base/protocols/http/main.zeek.html#type-HTTP::Info"><code class="docutils literal notranslate"><span class="pre">HTTP::Info</span></code></a> with data from the <code class="docutils literal notranslate"><span class="pre">COOKIE</span></code> header.</p>
</section>
<section id="unknown-http-headers">
<h3>Unknown HTTP Headers<a class="headerlink" href="#unknown-http-headers" title="Link to this heading">¶</a></h3>
<p>As defined in <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> and <span class="target" id="index-3"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7230.html"><strong>RFC 7230</strong></a>, and registered in IANA, there’re a
list of known HTTP headers. However, customised headers may be introduced when
implementation. Such unknown headers may contain significant information about
the HTTP traffic. Therefore, the script utilised <a class="reference external" href="https://docs.zeek.org/en/current/scripts/base/bif/plugins/Zeek_HTTP.events.bif.zeek.html#id-http_header"><code class="docutils literal notranslate"><span class="pre">http_header</span></code></a> event and
search for unknown headers, i.e. not included in <code class="docutils literal notranslate"><span class="pre">HTTP::header_names</span></code>, then
record them in the <code class="docutils literal notranslate"><span class="pre">http.log</span></code> files.</p>
</section>
<section id="http-post-data">
<h3>HTTP <code class="docutils literal notranslate"><span class="pre">POST</span></code> Data<a class="headerlink" href="#http-post-data" title="Link to this heading">¶</a></h3>
<p>As <span class="target" id="index-4"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc2616.html"><strong>RFC 2616</strong></a> suggests, we can utilise the data sent from <code class="docutils literal notranslate"><span class="pre">POST</span></code> command
to analyse information about outbound traffic. The script utilised
<a class="reference external" href="https://docs.zeek.org/en/current/scripts/base/bif/plugins/Zeek_HTTP.events.bif.zeek.html#id-http_entity_data"><code class="docutils literal notranslate"><span class="pre">http_entity_data</span></code></a> event, and save the <code class="docutils literal notranslate"><span class="pre">POST</span></code> data to <code class="docutils literal notranslate"><span class="pre">http.log</span></code> files.</p>
</section>
<section id="calculate-hash-values">
<h3>Calculate Hash Values<a class="headerlink" href="#calculate-hash-values" title="Link to this heading">¶</a></h3>
<p>Hash value of files can be used to detect malware. The script utilised
<a class="reference external" href="https://docs.zeek.org/en/current/scripts/base/bif/event.bif.zeek.html#id-file_new"><code class="docutils literal notranslate"><span class="pre">file_new</span></code></a> event, calculated and saved the hash values of files transferred
in the <code class="docutils literal notranslate"><span class="pre">files.log</span></code> file.</p>
</section>
<section id="smtp-phishing-detect">
<h3>SMTP Phishing Detect<a class="headerlink" href="#smtp-phishing-detect" title="Link to this heading">¶</a></h3>
<p>Since files transferred through SMTP traffic are not easy to gather and detect
phishing information. We introduced two Bro modules to perform such detection
on the SMTP traffic.</p>
<section id="a-phishing-module">
<h4>A. <a class="reference external" href="https://github.com/hosom/bro-phishing"><code class="docutils literal notranslate"><span class="pre">Phishing</span></code></a> Module<a class="headerlink" href="#a-phishing-module" title="Link to this heading">¶</a></h4>
<p>The <a class="reference external" href="https://github.com/hosom/bro-phishing"><code class="docutils literal notranslate"><span class="pre">Phishing</span></code></a> module mainly provides mass scam emails; phishing email detection
based on Levenshtein distance of sender address. It will elevate a
<code class="docutils literal notranslate"><span class="pre">phishing_link.log</span></code> log file, containing such malicious connections and URLs.</p>
</section>
<section id="b-phish-module">
<h4>B. <a class="reference external" href="https://github.com/initconf/smtp-url-analysis"><code class="docutils literal notranslate"><span class="pre">Phish</span></code></a> Module<a class="headerlink" href="#b-phish-module" title="Link to this heading">¶</a></h4>
<p>Primary scope of these bro policies is to give more insights into smtp-analysis
esp to track phishing events.</p>
<p>This is a subset of phish-analysis repo and doesn’t use any backed <code class="docutils literal notranslate"><span class="pre">postgres</span></code>
database. So relieves the user from <code class="docutils literal notranslate"><span class="pre">postgres</span></code> dependency while getting
basic phishing detection up and running very quickly.</p>
</section>
</section>
</section>
<section id="custom-python-hooks">
<h2>Custom Python Hooks<a class="headerlink" href="#custom-python-hooks" title="Link to this heading">¶</a></h2>
<p>In the BroAPT system, you can customise your own Python hooks for cross-analysis
to the log files. The BroAPT-Core framework will call such registered hooks on
each set of log files generacted from a PCAP file after processing of Bro.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Log analysis and generation can be done through the <a class="reference external" href="https://zlogging.jarryshaw.me">ZLogging</a> project,
which provides both loading and dumping interface to the processing of
Bro logs in an elegant Pythonic way.</p>
</div>
<p>User defined Bro scripts will be mapped into the Docker container at runtime.
The directory structure would be as following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/broapt/python/
│   # setup PYTHONPATH
├── __init__.py
│   # entry point
├── __main__.py
│   # config parser
├── cfgparser.py
│   # Bro script composer
├── compose.py
│   # global constants
├── const.py
│   # Bro log parser
├── logparser.py
│   # BroAPT-Core logic
├── process.py
│   # multiprocessing support
├── remote.py
│   # BroAPT-App logic
├── scan.py
│   # Python hooks
├── sites
│   │   # register hooks
│   ├── __init__.py
│   └── ...
│   # utility functions
└── utils.py
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">/broapt/python/sites/</span></code> is mapped from the host machine, which includes
user-defined site customisation Python hooks.</p>
<p>You can register your own hooks in the <code class="docutils literal notranslate"><span class="pre">/broapt/python/sites/__init__.py</span></code>,
by importing (<code class="docutils literal notranslate"><span class="pre">import</span></code>) them and add them to the <code class="docutils literal notranslate"><span class="pre">HOOK</span></code> and/or <code class="docutils literal notranslate"><span class="pre">EXIT</span></code>
registry lists.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">HOOK</span></code> registry, each registered hook function will be called after
a PCAP file is processed by the Bro IDS, and perform analysis on the logs
generated from the PCAP file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The hook function will be called with <strong>ONE</strong> argument, <code class="docutils literal notranslate"><span class="pre">log_name</span></code>, a
string (<code class="docutils literal notranslate"><span class="pre">str</span></code>) representing the folder name to the target logs.</p>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">EXIT</span></code> registry, each registered hook function will be called before
the main process of the BroAPT-Core framework exits.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The hook function will be called with <strong>NO</strong> argument.</p>
</div>
<p>At the moment, we have bundled two sets of Python hooks in the system.</p>
<section id="extracted-file-information">
<h3>Extracted File Information<a class="headerlink" href="#extracted-file-information" title="Link to this heading">¶</a></h3>
<p>Through <code class="docutils literal notranslate"><span class="pre">conn.log</span></code> and <code class="docutils literal notranslate"><span class="pre">files.log</span></code>, the BroAPT system generates a new
log file for information of extracted files, which includes the timestamp,
source and destination IP addresses of the transport layer connection
(TCP/UDP) transferring the file, MIME type of the file, as well as hash
values, see below:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field Name</p></th>
<th class="head"><p>Bro Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>Connection timestamp</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log_uuid</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>UUID of source logs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log_path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Absolute path to source logs (in Docker container)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Relative path to source logs</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dump_path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Absolute path to extracted file (in Docker container)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">local_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Relative path to extracted file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source_name</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Original filename (if present)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hosts</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">vector</span></code></p></td>
<td><p>Transferrer and receiver</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">conns</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">vector</span></code></p></td>
<td><p>Source and destination IP addresses and ports</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bro_mime_type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>MIME type probed by Bro IDS</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">real_mime_type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>MIME type detected by <code class="docutils literal notranslate"><span class="pre">libmagic</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">hash</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">table</span></code></p></td>
<td><p>Hash values (MD5, SHA1 and SHA256)</p></td>
</tr>
</tbody>
</table>
<p>The equivalent <a class="reference external" href="https://zlogging.jarryshaw.me/en/latest/zlogging.model.html">ZLogging data model</a> can be declared as following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExtractedFiles</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">FloatType</span><span class="p">()</span>
    <span class="n">log_uuid</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">log_path</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">dump_path</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">local_name</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">source_name</span>  <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="n">VectorType</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="n">RecordType</span><span class="p">(</span>
        <span class="n">tx</span><span class="o">=</span><span class="n">AddrType</span><span class="p">(),</span>
        <span class="n">rx</span><span class="o">=</span><span class="n">AddrType</span><span class="p">(),</span>
    <span class="p">))</span>
    <span class="n">conns</span> <span class="o">=</span> <span class="n">VectorType</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="n">RecordType</span><span class="p">(</span>
        <span class="n">src_h</span><span class="o">=</span><span class="n">AddrType</span><span class="p">(),</span>
        <span class="n">src_p</span><span class="o">=</span><span class="n">PortType</span><span class="p">(),</span>
        <span class="n">dst_h</span><span class="o">=</span><span class="n">AddrType</span><span class="p">(),</span>
        <span class="n">dst_p</span><span class="o">=</span><span class="n">PortType</span><span class="p">(),</span>
    <span class="p">))</span>
    <span class="n">bro_mime_type</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">real_mime_type</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">RecordType</span><span class="p">(</span>
        <span class="n">md5</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span>
        <span class="n">sha1</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span>
        <span class="n">sha256</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="http-connection-information">
<h3>HTTP Connection Information<a class="headerlink" href="#http-connection-information" title="Link to this heading">¶</a></h3>
<p>Through analysis upon <code class="docutils literal notranslate"><span class="pre">http.log</span></code>, the BroAPT system elevated a new log file with
more concentrated information about HTTP connections. Such log file contains all
HTTP connections from every processed PCAP file, and can be used for further analysis
based on <em>big data</em>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field Name</p></th>
<th class="head"><p>Bro Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">srcip</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">addr</span></code></p></td>
<td><p>Client IP address</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ts</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>Request timestamp (microseconds)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">url</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>Requests URL path</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ref</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Referer</span></code> header of the request (<em>base64</em> encoded)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ua</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header of the request (<em>base64</em> encoded)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dstip</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">addr</span></code></p></td>
<td><p>Server IP address</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cookie</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Cookie</span></code> header of the request (<em>base64</em> encoded)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">src_port</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">port</span></code></p></td>
<td><p>Client port</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">vector</span></code></p></td>
<td><p>Unregistered HTTP header fields (<em>JSON</em> encoded)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">method</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>HTTP method</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">body</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code> body data (<em>base64</em> encoded)</p></td>
</tr>
</tbody>
</table>
<p>The equivalent <a class="reference external" href="https://zlogging.jarryshaw.me/en/latest/zlogging.model.html">ZLogging data model</a> can be declared as following (with type
annotations):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HTTPConnections</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">srcip</span><span class="p">:</span> <span class="n">bro_addr</span>
    <span class="n">ts</span><span class="p">:</span> <span class="n">bro_float</span>
    <span class="n">url</span><span class="p">:</span> <span class="n">bro_string</span>
    <span class="n">ref</span><span class="p">:</span> <span class="n">bro_string</span>
    <span class="n">ua</span><span class="p">:</span> <span class="n">bro_string</span>
    <span class="n">dstip</span><span class="p">:</span> <span class="n">bro_addr</span>
    <span class="n">cookie</span><span class="p">:</span> <span class="n">bro_string</span>
    <span class="n">src_port</span><span class="p">:</span> <span class="n">bro_port</span>
    <span class="n">json</span><span class="p">:</span> <span class="n">bro_vector</span><span class="p">[</span><span class="n">bro_string</span><span class="p">]</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">bro_string</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">bro_string</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">BroAPT</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=JarryShaw&repo=broapt&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configurations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="framework.html">Internal Frameworks</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">BroAPT-Core Extration Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="broapt-app.html">BroAPT-App Detection Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="framework.html#implementation-details">Implementation Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="framework.html">Internal Frameworks</a><ul>
      <li>Previous: <a href="framework.html" title="previous chapter">Internal Frameworks</a></li>
      <li>Next: <a href="broapt-app.html" title="next chapter">BroAPT-App Detection Framework</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Jarry Shaw.
      
      |
      <a href="_sources/broapt-core.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/JarryShaw/broapt" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>