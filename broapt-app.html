
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BroAPT-App Detection Framework &#8212; BroAPT 2020.03.14 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="BroAPT-Core Extration Framework" href="broapt-core.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="broapt-app-detection-framework">
<h1>BroAPT-App Detection Framework<a class="headerlink" href="#broapt-app-detection-framework" title="Permalink to this headline">¶</a></h1>
<p>The BroAPT-App framework processes extracted files, perform malware detection
upon those files with detection API configured through the configuration file.</p>
<img alt="BroAPT-App Detection Framework" src="_images/BroAPT.008.png" />
<ol class="arabic" start="0">
<li><p>The BroAPT-App framework fetches basic information about the extracted file,
including file path, MIME type, file UID, source PCAP file, etc.</p>
<p>Each file extracted, since it will be named after:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROTOCOL</span><span class="o">-</span><span class="n">FUID</span><span class="o">-</span><span class="n">MIMETYPE</span><span class="o">.</span><span class="n">EXT</span>
</pre></div>
</div>
<p>with such pattern, the BroAPT-App framework will generate an <code class="docutils literal notranslate"><span class="pre">Entry</span></code> to
represent the information of the target file, e.g. for a extracted file
named:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">application</span><span class="o">/</span><span class="n">vnd</span><span class="o">.</span><span class="n">openxmlformats</span><span class="o">-</span><span class="n">officedocument</span><span class="o">/</span><span class="n">HTTP</span><span class="o">-</span><span class="n">F3Df5B3z9UI3yi5J03</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">msword</span><span class="o">.</span><span class="n">docx</span>
</pre></div>
</div>
<p>the BroAPT-App framework will generate the <code class="docutils literal notranslate"><span class="pre">Entry</span></code> object as following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s1">&#39;application/vnd.openxmlformats-officedocument/HTTP-F3Df5B3z9UI3yi5J03.application.msword.docx&#39;</span><span class="p">,</span>
    <span class="n">uuid</span><span class="o">=</span><span class="s1">&#39;F3Df5B3z9UI3yi5J03&#39;</span><span class="p">,</span>
    <span class="n">mime</span><span class="o">=</span><span class="n">MIME</span><span class="p">(</span>
        <span class="n">media_type</span><span class="o">=</span><span class="s1">&#39;application&#39;</span><span class="p">,</span>
        <span class="n">subtype</span><span class="o">=</span><span class="s1">&#39;msword&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;application/msword&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Based on the MIME type, the BroAPT-App framework will obtain MIME specific
detection API for the extracted file.</p></li>
<li><p>The BroAPT-App framework will then start detecting the extracted file based
on the specification described in the API.</p>
<p>When detection, as the Docker container may not be capable of such action,
the BroAPT-App framework may request the BroAPT-Daemon server to <em>remote</em>
detect the extracted file.</p>
<img alt="BroAPT Client-Server Detection Framework" src="_images/BroAPT.010.png" />
<p>The BroAPT-Daemon server is a RESTful API server implemented using <a class="reference external" href="https://flask.palletsprojects.com">Flask</a>
microframework. At the moment it supports following APIs:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 14%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>URI Routing</p></th>
<th class="head"><p>HTTP Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/api/v1.0/list</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p>Query detection listing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/api/v1.0/report/&lt;id&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">GET</span></code></p></td>
<td><p>Query detection report</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/api/v1.0/scan</span> <span class="pre">data={&quot;key&quot;:</span> <span class="pre">&quot;value&quot;}</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">POST</span></code></p></td>
<td><p>Request <em>remote</em> detection</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/api/v1.0/delete/&lt;id&gt;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p></td>
<td><p>Delete detection record</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="section" id="mime-specific-api-configuration">
<h2>MIME Specific API Configuration<a class="headerlink" href="#mime-specific-api-configuration" title="Permalink to this headline">¶</a></h2>
<p>In the BroAPT-App framework, we used an API configuration file to provide the BroAPT
system with MIME specific detection mechanism. The configuration file is written in
YAML, inspired by Docker Compose and Travis CI.</p>
<p>The directory structure of API configuration file and its related files are as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/api/
│   # API configuration file
├── api.yml
│   # MIME: application/*
├── application/
│   └── ...
│   # MIME: audio/*
├── audio/
│   └── ...
│   # default API
├── example/
│   └── ...
│   # MIME: font/*
├── font/
│   └── ...
│   # MIME: image/*
├── image/
│   └── ...
│   # MIME: message/*
├── message/
│   └── ...
│   # MIME: model/*
├── model/
│   └── ...
│   # MIME: multipart/*
├── multipart/
│   └── ...
│   # MIME: text/*
├── text/
│   └── ...
│   # MIME: video/*
└── video/
   └── ...
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">/api/</span></code> folder will be mapped into the Docker container at runtime and the
<code class="docutils literal notranslate"><span class="pre">/api/api.yml</span></code> is the exact API configuration file. The API for <code class="docutils literal notranslate"><span class="pre">example</span></code> MIME
type is the default fallback detection method for those with <strong>NO</strong> existing detection
API configured.</p>
<p>In the configuration file, you can specify global environment variables under the
<code class="docutils literal notranslate"><span class="pre">environment</span></code> key:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">environment</span><span class="p">:</span>
  <span class="c1"># API root path (from environment vairable)</span>
  <span class="nt">API_ROOT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${BROAPT_API_ROOT}</span>
  <span class="c1"># Python 3.6</span>
  <span class="nt">PYTHON36</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/python3.6</span>
  <span class="c1"># Python 2.7</span>
  <span class="nt">PYTHON27</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/python</span>
  <span class="c1"># Shell/Bash</span>
  <span class="nt">SHELL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
</pre></div>
</div>
<p>And for a certain MIME, e.g. PDF files (MIME is <code class="docutils literal notranslate"><span class="pre">application/pdf</span></code>), the configuration
should be as following:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">pdf</span><span class="p">:</span>
    <span class="nt">remote</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="c1"># default working directory is ``/api/application/pdf/``</span>
    <span class="c1"># now changed to ``/api/application/pdf/pdf_analysis``</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pdf_analysis</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">ENV_FOO</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">ENV_BAR</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cliche</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apt-get update</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apt-get install -y python python-pip</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON27} -m pip install -r requirements.txt</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf /var/lib/apt/lists/*</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apt-get remove -y --auto-remove python-pip</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apt-get clean</span>
    <span class="nt">scripts</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON27} detect.py [...]</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON27} report.py</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Shell</em>-like globing is now supported for MIME types, you may specify an API
using <code class="docutils literal notranslate"><span class="pre">application/vnd.ms-*</span></code>, which will be used for both <code class="docutils literal notranslate"><span class="pre">application/vnd.ms-excel</span></code>
and <code class="docutils literal notranslate"><span class="pre">application/ms-powerpoint</span></code>.</p>
<p>In the configuration file, the <code class="docutils literal notranslate"><span class="pre">report</span></code> key is mandatory.</p>
<p>If set <code class="docutils literal notranslate"><span class="pre">remote</span></code> key as <code class="docutils literal notranslate"><span class="pre">true</span></code>, the BroAPT-App framework will request the
BroAPT-Daemon server to perform <em>remote</em> detection.</p>
<p>And if an API configuration is shared by multiple MIME types, you should set
<code class="docutils literal notranslate"><span class="pre">shared</span></code> key as <code class="docutils literal notranslate"><span class="pre">true</span></code>, so that the API would be <em>process-safe</em> at runtime.</p>
</div>
<p>After parsing through the <a class="reference internal" href="api.app.python.cfgparser.html#cfgparser.parse" title="cfgparser.parse"><code class="xref py py-func docutils literal notranslate"><span class="pre">cfgparser.parse()</span></code></a> function, the API configuration
above will be represented as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">API</span><span class="p">(</span>
    <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;pdf_analysis&#39;</span><span class="p">,</span>
    <span class="n">environ</span><span class="o">=</span><span class="p">{</span>
       <span class="s1">&#39;API_ROOT&#39;</span><span class="p">:</span> <span class="s1">&#39;$</span><span class="si">{BROAPT_API_ROOT}</span><span class="s1">&#39;</span><span class="p">,</span>
       <span class="s1">&#39;PYTHON36&#39;</span><span class="p">:</span> <span class="s1">&#39;/usr/bin/python3.6&#39;</span><span class="p">,</span>
       <span class="s1">&#39;PYTHON27&#39;</span><span class="p">:</span> <span class="s1">&#39;/usr/bin/python&#39;</span><span class="p">,</span>
       <span class="s1">&#39;SHELL&#39;</span><span class="p">:</span> <span class="s1">&#39;/bin/bash&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ENV_FOO&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
       <span class="s1">&#39;ENV_BAR&#39;</span><span class="p">:</span> <span class="s1">&#39;cliche&#39;</span>
    <span class="p">},</span>
    <span class="n">install</span><span class="o">=</span><span class="p">[</span>
       <span class="s1">&#39;apt-get update&#39;</span><span class="p">,</span>
       <span class="s1">&#39;apt-get install -y python python-pip&#39;</span><span class="p">,</span>
       <span class="s1">&#39;$</span><span class="si">{PYTHON27}</span><span class="s1"> -m pip install -r requirements.txt&#39;</span><span class="p">,</span>
       <span class="s1">&#39;rm -rf /var/lib/apt/lists/*&#39;</span><span class="p">,</span>
       <span class="s1">&#39;apt-get remove -y --auto-remove python-pip&#39;</span><span class="p">,</span>
       <span class="s1">&#39;apt-get clean&#39;</span>
    <span class="p">],</span>
    <span class="n">scripts</span><span class="o">=</span><span class="p">[</span>
       <span class="s1">&#39;$</span><span class="si">{PYTHON27}</span><span class="s1"> detect.py [...]&#39;</span><span class="p">,</span>
       <span class="o">...</span>
    <span class="p">],</span>
    <span class="n">report</span><span class="o">=</span><span class="s1">&#39;$</span><span class="si">{PYTHON27}</span><span class="s1"> report.py&#39;</span><span class="p">,</span>
    <span class="n">remote</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">shared</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span>
    <span class="n">inited</span><span class="o">=&lt;</span><span class="n">Synchronized</span> <span class="n">wrapper</span> <span class="k">for</span> <span class="n">c_ubyte</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">locked</span><span class="o">=&lt;</span><span class="n">Lock</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">unknown</span><span class="p">)</span><span class="o">&gt;</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">API.inited</span></code> is to mark if the installation process had been run successfully.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">API.shared</span></code> is to mark if the configuration is shared by multiple MIME types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">API.locked</span></code> is to mark if the process is locked to prevent resource competition.</p></li>
</ul>
<p>At runtime, if the BroAPT-App framework is to detect a file at <code class="docutils literal notranslate"><span class="pre">/dump/application/pdf/test.pdf</span></code>,
the main procedure is as follows:</p>
<ol class="arabic" start="0">
<li><p>Set environment variables:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">API_ROOT</span><span class="o">=</span><span class="s2">&quot;/api/&quot;</span>
<span class="nv">PYTHON36</span><span class="o">=</span><span class="s2">&quot;/usr/bin/python3.6&quot;</span>
<span class="nv">PYTHON27</span><span class="o">=</span><span class="s2">&quot;/usr/bin/python&quot;</span>
<span class="nv">SHELL</span><span class="o">=</span><span class="s2">&quot;/bin/bash&quot;</span>
<span class="nv">ENV_FOO</span><span class="o">=</span><span class="m">1</span>
<span class="nv">ENV_BAR</span><span class="o">=</span><span class="s2">&quot;cliche&quot;</span>
<span class="nv">BROAPT_PATH</span><span class="o">=</span><span class="s2">&quot;/dump/application/pdf/test.pdf&quot;</span>
<span class="nv">BROAPT_MIME</span><span class="o">=</span><span class="s2">&quot;application/pdf&quot;</span>
</pre></div>
</div>
</li>
<li><p>Change the current working directory to <code class="docutils literal notranslate"><span class="pre">/api/application/pdf/pdf_analysis</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">API.inited</span></code> is now <code class="docutils literal notranslate"><span class="pre">False</span></code>, which means the installation process is
<strong>NOT</strong> yet performed, then acquire <code class="docutils literal notranslate"><span class="pre">API.locked</span></code> and execute the commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>apt-get update
apt-get install -y python python-pip
python -m pip install -r requirements.txt
rm -rf /var/lib/apt/lists/*
apt-get remove -y --auto-remove python-pip
apt-get clean
</pre></div>
</div>
<p>afterwards, toggle <code class="docutils literal notranslate"><span class="pre">API.inited</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code> and release <code class="docutils literal notranslate"><span class="pre">API.locked</span></code>.</p>
</li>
<li><p>Execute detection commands:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/usr/bin/python detect.py <span class="o">[</span>...<span class="o">]</span>
...
</pre></div>
</div>
</li>
<li><p>Once finished, execute report generation script <code class="docutils literal notranslate"><span class="pre">/usr/bin/python</span> <span class="pre">report.py</span></code>.</p></li>
</ol>
</div>
<div class="section" id="integrated-detection-services">
<h2>Integrated Detection Services<a class="headerlink" href="#integrated-detection-services" title="Permalink to this headline">¶</a></h2>
<p>At the moment, the BroAPT system had integrated six detection solusions.</p>
<div class="section" id="default-detection-powered-by-virustotal">
<h3>Default Detection powered by VirusTotal<a class="headerlink" href="#default-detection-powered-by-virustotal" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.virustotal.com">VirusTotal</a> aggregates many antivirus products and online scan engines to check
for viruses that the user’s own antivirus may have missed, or to verify against
any false positives.</p>
<p>As mentioned above, the <code class="docutils literal notranslate"><span class="pre">example</span></code> MIME type is the default fallback detection
mechanism in case of missing configuration. The configuration is as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">example</span><span class="p">:</span>
  <span class="nt">environ</span><span class="p">:</span>
    <span class="c1">## sleep interval</span>
    <span class="nt">VT_INTERVAL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
    <span class="c1">## max retry for report</span>
    <span class="nt">VT_RETRY</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
    <span class="c1">## percentage of positive threshold</span>
    <span class="nt">VT_PERCENT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">50</span>
    <span class="c1">## VT API key</span>
    <span class="nt">VT_API</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="c1">## path to VT file scan reports</span>
    <span class="nt">VT_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log/bro/tmp/</span>
  <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON36} virustotal.py</span>
</pre></div>
</div>
</div>
<div class="section" id="android-apk-detection-powered-by-andropytool">
<h3>Android APK Detection powered by AndroPyTool<a class="headerlink" href="#android-apk-detection-powered-by-andropytool" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/alexMyG/AndroPyTool">AndroPyTool</a> is a tool for extracting static and dynamic features from Android
APKs. It combines different well-known Android apps analysis tools such as DroidBox,
FlowDroid, Strace, AndroGuard or VirusTotal analysis. Provided a source directory
containing APK files, AndroPyTool applies all these tools to perform pre-static,
static and dynamic analysis and generates files of features in JSON and CSV formats
and also allows to save all the data in a MongoDB database.</p>
<p>AndroPyTool is configured for detection of APK files, whose MIME type is
<code class="docutils literal notranslate"><span class="pre">application/vnd.android.package-archive</span></code> in IANA registry. The configuration
is as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">vnd.android.package-archive</span><span class="p">:</span>
    <span class="nt">remote</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AndroPyTool</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">APK_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/traffic/log/bro/tmp/</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker pull alexmyg/andropytool</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${SHELL} detect.sh</span>
</pre></div>
</div>
<p>Since the environment configuration of AndroPyTool is much too complex,
we directly used its official Docker image for detection. Therefore, the AndroPyTool
is called through <em>remote</em> detection mechanism, i.e. BroApt-Daemon server performs
detection using AndroPyTool Docker image on APK files then send the report back to
BroAPT-App framework for records.</p>
</div>
<div class="section" id="office-document-detection-powered-by-maliciousmacrobot">
<h3>Office Document Detection powered by MaliciousMacroBot<a class="headerlink" href="#office-document-detection-powered-by-maliciousmacrobot" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/egaus/MaliciousMacroBot">MaliciousMacroBot</a> is to provide a powerful malicious file triage tool for cyber
responders; help fill existing detection gaps for malicious office documents, which
are still a very prevalent attack vector today; deliver a new avenue for threat
intelligence, a way to group similar malicious office documents together to identify
phishing campaigns and track use of specific malicious document templates.</p>
<p>MaliciousMacroBot is configured for detecting Office files, which is a document type
based on XML, such as  Microsoft Office and OpenOffice. The MIME types of such documents
include <code class="docutils literal notranslate"><span class="pre">application/msword</span></code>, <code class="docutils literal notranslate"><span class="pre">application/ms-excel</span></code>, <code class="docutils literal notranslate"><span class="pre">application/vnd.ms-powerpoint</span></code>
and <code class="docutils literal notranslate"><span class="pre">application/vnd.openxmlformats-officedocument.*</span></code>, etc. The configuration is as
below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">vnd.openxmlformats-officedocument.*</span><span class="p">:</span> <span class="nl">&amp;officedocument</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${API_ROOT}/application/vnd.openxmlformats-officedocument/</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">MMB_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log/bro/tmp/</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yum install -y git</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">git clone https://github.com/egaus/MaliciousMacroBot.git</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON36} -m pip install ./MaliciousMacroBot/</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yum clean -y all</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON36} MaliciousMacroBot-detect.py</span>
    <span class="nt">shared</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">officedocument</span>
  <span class="nt">msword</span><span class="p">:</span> <span class="nv">*officedocument</span>
  <span class="nt">vnd.ms-excel</span><span class="p">:</span> <span class="nv">*officedocument</span>
  <span class="nt">vnd.ms-powerpoint</span><span class="p">:</span> <span class="nv">*officedocument</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As you may have noticed here, the configured MIME types detected by MaliciousMacroBot
has a <code class="docutils literal notranslate"><span class="pre">*</span></code> globing syntax, such shall be matched using <em>shell</em>-like globing mechanism.</p>
</div>
<p>As the MaliciousMacroBot detection method is shared by multiple MIME types, we
set the <code class="docutils literal notranslate"><span class="pre">shared</span></code> key in the API to an identifier for the detection method, so
that at runtime, such detection method will be <em>process-safe</em>.</p>
</div>
<div class="section" id="linux-elf-detection-powered-by-elf-parser">
<h3>Linux ELF Detection powered by ELF Parser<a class="headerlink" href="#linux-elf-detection-powered-by-elf-parser" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://elfparser.com">ELF Parser</a> is designed for static ELF analysis. It can quickly determine the
capabilities of an ELF binary through static analysis, then discover if the binary
is known malware or a possible threat without ever executing the file.</p>
<p>ELF Parser is configured for the ELF file (MIME type: <code class="docutils literal notranslate"><span class="pre">application/x-executable</span></code>
only. The configuration is as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">x-executable</span><span class="p">:</span>
    <span class="c1">## ELF Parser</span>
    <span class="nt">remote</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">ELF_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/traffic/log/bro/tmp/</span>
      <span class="nt">ELF_SCORE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ELF-Parser</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">docker build --tag elfparser:1.4.0 --rm .</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${SHELL} detect.sh</span>
</pre></div>
</div>
</div>
<div class="section" id="common-linux-malware-detection-powered-by-lmd">
<h3>Common Linux Malware Detection powered by LMD<a class="headerlink" href="#common-linux-malware-detection-powered-by-lmd" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.rfxn.com/projects/linux-malware-detect">Linux Malware Detect</a> (LMD) is a malware scanner for Linux, that is designed around
the threats faced in shared hosted environments. It uses threat data from network edge
intrusion detection systems to extract malware that is actively being used in attacks
and generates signatures for detection. In addition, threat data is also derived from
user submissions with the LMD checkout feature and from malware community resources.
The signatures that LMD uses are MD5 file hashes and HEX pattern matches, they are also
easily exported to any number of detection tools such as ClamAV.</p>
<p>LMD is configured for various common file types. The configuration is as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">octet-stream</span><span class="p">:</span> <span class="nl">&amp;lmd</span>
    <span class="c1">## LMD</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${API_ROOT}/application/octet-stream/LMD</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">LMD_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log/bro/tmp/</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yum install -y git which</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">test -d ./linux-malware-detect/ ||</span>
        <span class="l l-Scalar l-Scalar-Plain">git clone https://github.com/rfxn/linux-malware-detect.git</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${SHELL} install.sh</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${SHELL} detect.sh</span>
    <span class="nt">shared</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">linux-maldet</span>
<span class="nt">text</span><span class="p">:</span>
  <span class="nt">html</span><span class="p">:</span> <span class="nv">*lmd</span>
  <span class="nt">x-c</span><span class="p">:</span> <span class="nv">*lmd</span>
  <span class="nt">x-perl</span><span class="p">:</span> <span class="nv">*lmd</span>
  <span class="nt">x-php</span><span class="p">:</span> <span class="nv">*lmd</span>
</pre></div>
</div>
</div>
<div class="section" id="malicious-javascript-detection-powered-by-jast">
<h3>Malicious JavaScript Detection powered by JaSt<a class="headerlink" href="#malicious-javascript-detection-powered-by-jast" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/Aurore54F/JaSt">JaSt</a> is a low-overhead solution that combines the extraction of features from
the abstract syntax tree with a random forest classifier to detect malicious JavaScript
instances. It is based on a frequency analysis of specific patterns, which are either
predictive of benign or of malicious samples. Even though the analysis is entirely static,
it yields a high detection accuracy of almost 99.5% and has a low false-negative rate
of 0.54%.</p>
<p>JaSt as is dedicated for javaScript files. The configuration is as below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">application</span><span class="p">:</span>
  <span class="nt">javascript</span><span class="p">:</span> <span class="nl">&amp;javascript</span>
    <span class="nt">workdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${API_ROOT}/application/javascript/JaSt</span>
    <span class="nt">environ</span><span class="p">:</span>
      <span class="nt">JS_LOG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/log/bro/tmp/</span>
    <span class="nt">install</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yum install -y epel-release</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">yum install -y git nodejs</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">test -d ./JaSt/ ||</span>
        <span class="l l-Scalar l-Scalar-Plain">git clone https://github.com/Aurore54F/JaSt.git</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON3} -m pip install</span>
          <span class="l l-Scalar l-Scalar-Plain">matplotlib</span>
          <span class="l l-Scalar l-Scalar-Plain">plotly</span>
          <span class="l l-Scalar l-Scalar-Plain">numpy</span>
          <span class="l l-Scalar l-Scalar-Plain">scipy</span>
          <span class="l l-Scalar l-Scalar-Plain">scikit-learn</span>
          <span class="l l-Scalar l-Scalar-Plain">pandas</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON3} ./JaSt/clustering/learner.py</span>
          <span class="l l-Scalar l-Scalar-Plain">--d ./sample/</span>
          <span class="l l-Scalar l-Scalar-Plain">--l ./lables/</span>
          <span class="l l-Scalar l-Scalar-Plain">--md ./models/</span>
          <span class="l l-Scalar l-Scalar-Plain">--mn broapt-jast</span>
    <span class="nt">scripts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON3} ./JaSt/clustering/classifier.py</span>
        <span class="l l-Scalar l-Scalar-Plain">--f ${BROAPT_PATH}</span>
        <span class="l l-Scalar l-Scalar-Plain">--m ./models/broapt-jast</span>
    <span class="nt">report</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${PYTHON3} detect.py</span>
    <span class="nt">shared</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">javascript</span>
<span class="nt">text</span><span class="p">:</span>
  <span class="nt">javascript</span><span class="p">:</span> <span class="nv">*javascript</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">BroAPT</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=JarryShaw&repo=broapt&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configurations</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="framework.html">Internal Frameworks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="broapt-core.html">BroAPT-Core Extration Framework</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BroAPT-App Detection Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="framework.html#implementation-details">Implementation Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="framework.html">Internal Frameworks</a><ul>
      <li>Previous: <a href="broapt-core.html" title="previous chapter">BroAPT-Core Extration Framework</a></li>
      <li>Next: <a href="api.html" title="next chapter">API Reference</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Jarry Shaw.
      
      |
      <a href="_sources/broapt-app.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/JarryShaw/broapt" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>