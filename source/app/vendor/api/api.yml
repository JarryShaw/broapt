## Configuration for API arguments of BroAPT-APP

###############################################################################
## Environment (global setup)
##
## Environment variables `${...}` used in API arguments will be translated
## according to the following values.
##
environment:
  # Python 3.6
  PYTHON: /usr/bin/python3.6
  PYTHON36: /usr/bin/python3.6
  PYTHON3: /usr/bin/python3.6
  # Python 2.7
  PYTHON27: /usr/bin/python
  PYTHON2: /usr/bin/python
  # Shell/Bash
  SHELL: /bin/bash

###############################################################################
## Example:
##
## - Target:
##   - MIME type: `application/pdf`
##   - file name: `/dump/application/pdf/test.pdf`
## - API:
##   - working directory: `./pdf_analysis`
##   - command: `python2.7 detect.py`
##   - API root: `/api/`
##   - environment: `ENV_FOO=1`, `ENV_BAR=this is an environment variable`
##
## The configuration section should then be:
##
## application:
##   ...  # other APIs
##   pdf:
##     workdir: pdf_analysis
##     environ:
##       ENV_FOO: 1
##       ENV_BAR: this is an environment variable
##     install:
##       - apt-get update
##       - apt-get install -y python python-pip
##       - python -m pip install -r requirements.txt
##       - rm -rf /var/lib/apt/lists/*
##       - apt-get remove -y --auto-remove python-pip
##       - apt-get clean
##     scripts:
##       - ${PYTHON27} detect.py [...]                # refer to /usr/bin/python
##       - ...                                        # and some random command
##
## BroAPT will work as following:
##
## 0. if run for the first time, run the following commands:
##    - `apt-get update`
##    - `apt-get install -y python python-pip`
##    - `python -m pip install -r requirements.txt`
##    - `rm -rf /var/lib/apt/lists/*`
##    - `apt-get remove -y --auto-remove python-pip`
##    - `apt-get clean`
## 1. set the following environment variables
##    # per target file
##    - BROAPT_FILE="/dump/application/pdf/test.pdf"
##    - BROAPT_MIME="application/pdf"
##    # per API configuration
##    - ENV_FOO=1
##    - ENV_BAR="this is an environment variable"
## 2. change the current working directory to
##    `/api/application/pdf/pdf_analysis`
## 3. call the API as the following commands:
##    - `/usr/bin/python detect.py [...]`
##    - `...`
##
## NOTE: `scripts` section is MANDATORY.
##

# APIs for `application` media type
application:
  vnd.android.package-archive:
    workdir: AndroPyTool
    environ:
      APK_PATH: /apk/
      ANDROID_HOME: $HOME/android-sdk-linux
      PATH: $PATH:$ANDROID_HOME/tools
      PATH: $PATH:$ANDROID_HOME/platform-tools
    install:
      - ${SHELL} AndroPyTool-setup.sh
    scripts:
      - ${PYTHON27} androPyTool.py -s ${APK_PATH}

# APIs for `audio` media type
audio:

# Default API for missing MIME types
example:
  workdir: .
  environ:
    ## sleep interval
    VT_INTERVAL: 10
    ## max retry for report
    VT_RETRY: 6
    ## percentage of positive threshold
    VT_PERCENT: 50
    ## VT API key
    #VT_API: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    ## path to VT file scan reports
    VT_LOG: /var/log/bro/tmp/
  install:
    - apt-get update
    - apt-get install -y --no-install-recommends python3-requests
    - apt-get clean
  scripts:
    - ${PYTHON36} virustotal.py

# APIs for `font` media type
font:

# APIs for `image` media type
image:

# APIs for `message` media type
message:

# APIs for `model` media type
model:

# APIs for `multipart` media type
multipart:

# APIs for `text` media type
text:

# APIs for `video` media type
video:
